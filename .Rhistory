install.packages(c("phytools", "phangorn", "ape"))
install.packages("Bioconductor")
install.packages(c("dplyr", "tidyr", "reshape2", "ggplot2"))
source("https://bioconductor.org/biocLite.R")
biocLite('ggtree')
library("ape", lib.loc="/usr/local/lib/R/3.2/site-library")
library("ggplot2", lib.loc="/usr/local/lib/R/3.2/site-library")
library("ggtree")
library("phytools", lib.loc="/usr/local/lib/R/3.2/site-library")
library("phangorn", lib.loc="/usr/local/lib/R/3.2/site-library")
install.packages("geiger")
?ggtree
bioLite
biocLite("ggtree")
library(Bioconductor)
library(biocLite)
library(bioconductor)
source("https://bioconductor.org/biocLite.R")
?bicLite
?biocLite
biocLite("ggtree")
library('ggtree')
install.packages("devtools")
library(devtools)
install_github('ggbiplot', 'vcv')
install_github('ggbiplot/vcv')
install.packages("stringr")
library(devtools)
biocLite(ggtree)
install.packages("ggtree")
library('ggtree')
source("https://bioconductor.org/biocLite.R")
biocLite("ggtree")
source("https://bioconductor.org/biocLite.R")
biocLite("EBImage")
source("https://bioconductor.org/biocLite.R")
biocLite("fftwtools")
source("https://bioconductor.org/biocLite.R")
biocLite("ggtree")
?t
?qt
qt(1-0.1/2, 8999)
qt(1-0.1/2, 1999)
qt(1-0.1/2, 999)
sqrt(9000)
sqrt(1000)
1.645023/sqrt(9000)
1.64638/sqrt(1000)
qt(1-0.1/2, 49)
qt(1-0.1/2, 199)
sqrt(50)
sqrt(200)
(1.653/14.14)/(1.677/7.07)
qt(1-0.01/2, 39)
127.95+(2.707913*(24.03/sqrt(40)))
127.95-(2.707913*(24.03/sqrt(40)))
(2.707913*(24.03/sqrt(40)))
qt(1-0.01/2, 99)
2.626*5.8/10
(1-pt(3.96551, df = 99))
0.7805/41.1467
setwd("~/Documents/0BIOL_Phylogenetics/phylobio_final_project")
ass = unique(read.table("Associations.csv", sep = '\t', header = T)[,c(1,2)])
amphipods = sort(as.vector(unique(ass$amphipod)))
hosts = sort(as.vector(unique(ass$host)))
library(reshape2)
assmatrix = dcast(ass, amphipod~host, length)
rownames(assmatrix) = assmatrix[,1]
heatmap(as.matrix(assmatrix[,2:94]), col=c("white", "orange"), Rowv=NA, Colv=NA)
library(igraph)
#prune the matrix according to amphipod spp available in 2013 phylogeny
treespp2013 = as.vector(read.table("Hurt2013spp.txt", sep = ",")[,1])
prunedmatrix = assmatrix[which(assmatrix$amphipod %in% treespp2013),]
prunedass = as.matrix(ass[which(ass$amphipod %in% treespp2013),])
heatmap(as.matrix(prunedmatrix[,2:94]), col=c("white", "orange"), Rowv=NA, Colv=NA)
#load the host tree
library(ape)
library(phytools)
library(ggtree)
ML = read.tree("RAxML/RAxML_bipartitions.18ShostML_boot100")
plot(ML)
nodelabels()
ML = reroot(ML, 78)
plot(ML)
TREE = ML
TREE$tip.label = str_replace_all(TREE$tip.label,'_',' ')
sharedspp = as.vector(prunedass[,2][which(prunedass[,2] %in% TREE$tip.label)])
#prune the tree
nodatatipnames = TREE$tip.label[which(!(TREE$tip.label %in% sharedspp))]
nodatatips = c(1:length(TREE$tip.label))[which(TREE$tip.label %in% nodatatipnames)]
prunedtree = drop.tip(TREE, nodatatips)
prunedtree$tip.label
plot(prunedtree)
ultram = chronos(prunedtree)
plot(ultram)
#reprune the matrix
library(stringr)
prunedass[,2] = as.matrix(str_replace_all(prunedass[,2],'conica','sp.'))
reprunedass = as.matrix(prunedass[which(prunedass[,2] %in% ultram$tip.label),])
reprunedass = reprunedass[match(ultram$tip.label, reprunedass[,2]),]
reprunedassmatrix = as.matrix(dcast(as.data.frame(reprunedass), amphipod~host, length))
reprunedassmatrix = reprunedassmatrix[,2:16]
class(reprunedassmatrix) <- "numeric"
rownames(reprunedassmatrix) = dcast(as.data.frame(reprunedass), amphipod~host, length)[,1]
heatmap(reprunedassmatrix[,2:9], col=c("white", "orange"), Rowv=NA, Colv=NA)
ML = read.tree("RAxML/RAxML_bipartitions.18ShostML_boot100")
plot(ML)
nodelabels()
ML = reroot(ML, 78)
plot(ML)
TREE = ML
TREE$tip.label = str_replace_all(TREE$tip.label,'_',' ')
sharedspp = as.vector(prunedass[,2][which(prunedass[,2] %in% TREE$tip.label)])
nodatatipnames = TREE$tip.label[which(!(TREE$tip.label %in% sharedspp))]
nodatatips = c(1:length(TREE$tip.label))[which(TREE$tip.label %in% nodatatipnames)]
prunedtree = drop.tip(TREE, nodatatips)
prunedtree$tip.label
plot(prunedtree)
ultram = chronos(prunedtree)
plot(ultram)
library(stringr)
prunedass[,2] = as.matrix(str_replace_all(prunedass[,2],'conica','sp.'))
reprunedass = as.matrix(prunedass[which(prunedass[,2] %in% ultram$tip.label),])
reprunedass = reprunedass[match(ultram$tip.label, reprunedass[,2]),]
reprunedassmatrix = as.matrix(dcast(as.data.frame(reprunedass), amphipod~host, length))
reprunedassmatrix = reprunedassmatrix[,2:16]
class(reprunedassmatrix) <- "numeric"
rownames(reprunedassmatrix) = dcast(as.data.frame(reprunedass), amphipod~host, length)[,1]
heatmap(reprunedassmatrix[,2:9], col=c("white", "orange"), Rowv=NA, Colv=NA)
g <- graph_from_edgelist(as.matrix(ass))
V(g)$color <- ifelse(V(g)$name %in% hosts, "lightblue", "red")
V(g)$label.color <- ifelse(V(g)$name %in% hosts, "blue", "darkred")
V(g)$types <- ifelse(V(g)$name %in% hosts, F, T)
Lo = layout_as_bipartite(g, types = V(g)$types, hgap = 15, vgap = 600)
Lc = layout_in_circle(g, order = c(V(g)[which(V(g)$name %in% amphipods)], V(g)[which(V(g)$name %in% hosts)]))
c= tkplot(g, canvas.width = 700, canvas.height = 700, vertex.size = 2.8, layout=Lc, vertex.label.dist = 0.3, vertex.label.cex = 0.5)
tkplot.fit.to.screen(c, height = 500, width = 500)
tkplot.center(c)
a = tkplot(g, canvas.width = 700, canvas.height = 700, vertex.size = 2.8, layout=Lo, vertex.label.dist = 0.3, vertex.label.cex = 0.5)
tkplot.rotate(a, degree = 90)
tkplot.fit.to.screen(a, height = 500, width = 500)
tkplot.center(a)
ggtree(ultram, layout="circular") + geom_tiplab(aes(angle=angle), color='blue')
yx = ggtree(labeled) + geom_tiplab(color='black', size = 3) + geom_treescale(x=2008, y=1)
labeled = ultram
labeled$edge.length = labeled$edge.length * 100
dd = data.frame(taxa  = labeled$tip.label, amphipod = reprunedass[,1])
p = ggtree(labeled, layout="rectangular") + xlim(NA, 23)
p = p %<+% dd + geom_tiplab(aes(color=amphipod), show_guide = FALSE, size = 3.5) + geom_tippoint(aes(color=amphipod), alpha=0.25)
p+theme(legend.position="right") + guides(color=guide_legend(title="Amphipod", reverse=T))
phylopic(p, "a838b707-229c-4ced-bf94-e6b10d242162.1024", color = "blue")
labeled = ultram
ggtree(labeled)
dd = data.frame(taxa  = labeled$tip.label, amphipod = reprunedass[,1])
p = ggtree(labeled, layout="rectangular") + xlim(NA, 23)
p = p %<+% dd + geom_tiplab(aes(color=amphipod), show_guide = FALSE, size = 3.5) + geom_tippoint(aes(color=amphipod), alpha=0.25)
p+theme(legend.position="right") + guides(color=guide_legend(title="Amphipod", reverse=T))
phylopic(p, "a838b707-229c-4ced-bf94-e6b10d242162.1024", color = "blue")
phylopic(p, "a838b707-229c-4ced-bf94-e6b10d242162.1024.png", color = "blue")
labeled$edge.length = labeled$edge.length * 100
dd = data.frame(taxa  = labeled$tip.label, amphipod = reprunedass[,1])
p = ggtree(labeled, layout="rectangular") + xlim(NA, 23)
p = p %<+% dd + geom_tiplab(aes(color=amphipod), show_guide = FALSE, size = 3.5) + geom_tippoint(aes(color=amphipod), alpha=0.25)
p+theme(legend.position="right") + guides(color=guide_legend(title="Amphipod", reverse=T))
labeled = ultram
labeled$edge.length = labeled$edge.length * 20
dd = data.frame(taxa  = labeled$tip.label, amphipod = reprunedass[,1])
p = ggtree(labeled, layout="rectangular") + xlim(NA, 23)
p = p %<+% dd + geom_tiplab(aes(color=amphipod), show_guide = FALSE, size = 3.5) + geom_tippoint(aes(color=amphipod), alpha=0.25)
p+theme(legend.position="right") + guides(color=guide_legend(title="Amphipod", reverse=T))
ggtree(ultram, layout="circular") + geom_tiplab(aes(angle=angle), color='blue')
labeled = ultram
labeled$edge.length = labeled$edge.length * 10
dd = data.frame(taxa  = labeled$tip.label, amphipod = reprunedass[,1])
p = ggtree(labeled, layout="rectangular") + xlim(NA, 23)
p = p %<+% dd + geom_tiplab(aes(color=amphipod), show_guide = FALSE, size = 3.5) + geom_tippoint(aes(color=amphipod), alpha=0.25)
p+theme(legend.position="right") + guides(color=guide_legend(title="Amphipod", reverse=T))
