install.packages(c("phytools", "phangorn", "ape"))
install.packages("Bioconductor")
install.packages(c("dplyr", "tidyr", "reshape2", "ggplot2"))
source("https://bioconductor.org/biocLite.R")
biocLite('ggtree')
library("ape", lib.loc="/usr/local/lib/R/3.2/site-library")
library("ggplot2", lib.loc="/usr/local/lib/R/3.2/site-library")
library("ggtree")
library("phytools", lib.loc="/usr/local/lib/R/3.2/site-library")
library("phangorn", lib.loc="/usr/local/lib/R/3.2/site-library")
install.packages("geiger")
?ggtree
bioLite
biocLite("ggtree")
library(Bioconductor)
library(biocLite)
library(bioconductor)
source("https://bioconductor.org/biocLite.R")
?bicLite
?biocLite
biocLite("ggtree")
library('ggtree')
install.packages("devtools")
library(devtools)
install_github('ggbiplot', 'vcv')
install_github('ggbiplot/vcv')
install.packages("stringr")
library(devtools)
biocLite(ggtree)
install.packages("ggtree")
library('ggtree')
source("https://bioconductor.org/biocLite.R")
biocLite("ggtree")
source("https://bioconductor.org/biocLite.R")
biocLite("EBImage")
source("https://bioconductor.org/biocLite.R")
biocLite("fftwtools")
source("https://bioconductor.org/biocLite.R")
biocLite("ggtree")
?t
?qt
qt(1-0.1/2, 8999)
qt(1-0.1/2, 1999)
qt(1-0.1/2, 999)
sqrt(9000)
sqrt(1000)
1.645023/sqrt(9000)
1.64638/sqrt(1000)
qt(1-0.1/2, 49)
qt(1-0.1/2, 199)
sqrt(50)
sqrt(200)
(1.653/14.14)/(1.677/7.07)
qt(1-0.01/2, 39)
127.95+(2.707913*(24.03/sqrt(40)))
127.95-(2.707913*(24.03/sqrt(40)))
(2.707913*(24.03/sqrt(40)))
qt(1-0.01/2, 99)
2.626*5.8/10
(1-pt(3.96551, df = 99))
0.7805/41.1467
library(stringr)
library(ape)
library(phytools)
library(ggtree)
library(reshape2)
library(igraph)
library(picante)
setwd("~/Documents/0BIOL_Phylogenetics/phylobio_final_project")
ass = unique(read.table("Associations.csv", sep = '\t', header = T)[,c(1,2)])
amphipods = sort(as.vector(unique(ass$amphipod)))
hosts = sort(as.vector(unique(ass$host)))
assmatrix = dcast(ass, amphipod~host, length)
rownames(assmatrix) = assmatrix[,1]
heatmap(as.matrix(assmatrix[,2:94]), col=c("white", "orange"), Rowv=NA, Colv=NA)
#Load amphipod tree Maximum Likelihood
amphipodML = read.tree("Amphipods/RAxML/RAxML_bipartitions.amphipodsCOI_MSAML_boot100")
amphipodML = drop.tip(amphipodML, which(amphipodML$tip.label == "Cyathura_sp." | amphipodML$tip.label == "Idotea_sp."))
plot(amphipodML)
nodelabels()
amphipodML=reroot(amphipodML, 52)
plot(amphipodML)
hostree = read.nexus("FirstHostRound/output/host18S_bayesian2_run_1.tree")
hostree$tip.label
#Bayesian GTR+Gamma tree
extreeBAYES = read.nexus("ExtendedHosts/output/host_ext_MSA_bayesian_run_1.tree")
badtips = which(!(extreeBAYES$tip.label %in% hostree$tip.label))
hostBayes = drop.tip(extreeBAYES, badtips)
plot(hostBayes)
nodelabels()
hostBayes = reroot(hostBayes, 80)
plot(hostBayes)
TREE = hostBayes
#GTR+Gamma Maximum Likelihood
MLext = read.tree("ExtendedHosts/RAxML/RAxML_bipartitions.EXThostML_boot100")
badtips = which(!(MLext$tip.label %in% hostree$tip.label))
hostML = drop.tip(MLext, badtips)
plot(hostML)
nodelabels()
hostML = reroot(hostML, 85)
plot(hostML)
TREE = hostML
#prune the tree
TREE$tip.label = str_replace_all(TREE$tip.label,'_',' ')
amphipodML$tip.label = str_replace_all(amphipodML$tip.label,'_',' ')
#prune the matrix according to amphipod spp available in 2013 phylogeny
treespp2013 = amphipodML$tip.label
prunedmatrix = assmatrix[which(assmatrix$amphipod %in% treespp2013),]
prunedass = as.matrix(ass[which(ass$amphipod %in% treespp2013),])
heatmap(as.matrix(prunedmatrix[,2:94]), col=c("white", "orange"), Rowv=NA, Colv=NA)
#Get species shared with the hosts
sharedspp = as.vector(prunedass[,2][which(prunedass[,2] %in% TREE$tip.label)])
#prune the tree with the shared species in association data and amphipod tree
nodatatipnames = TREE$tip.label[which(!(TREE$tip.label %in% sharedspp))]
nodatatips = c(1:length(TREE$tip.label))[which(TREE$tip.label %in% nodatatipnames)]
prunedtree = drop.tip(TREE, nodatatips)
prunedtree$tip.label
plot(prunedtree)
ultram = chronos(prunedtree)
plot(ultram)
ultramphipod = chronos(amphipodML)
plot(ultramphipod)
prunedass[,2] = as.matrix(str_replace_all(prunedass[,2],'conica','sp.'))
reprunedass = as.matrix(prunedass[which(prunedass[,2] %in% ultram$tip.label),])
reprunedass = reprunedass[match(ultram$tip.label, reprunedass[,2]),]
reprunedassmatrix = as.matrix(dcast(as.data.frame(reprunedass), amphipod~host, length))
reprunedassmatrix = reprunedassmatrix[,2:16]
class(reprunedassmatrix) <- "numeric"
rownames(reprunedassmatrix) = dcast(as.data.frame(reprunedass), amphipod~host, length)[,1]
heatmap(reprunedassmatrix[,2:9], col=c("white", "orange"), Rowv=NA, Colv=NA)
View(reprunedassmatrix)
amphipodML = drop.tip(amphipodML, which(!(amphipodML$tip.label %in% rownames(reprunedassmatrix)))
ultramphipod = chronos(amphipodML)
plot(ultramphipod)
which(!(amphipodML$tip.label %in% rownames(reprunedassmatrix))
amphipodML = drop.tip(amphipodML, which(!(amphipodML$tip.label %in% rownames(reprunedassmatrix))))
ultramphipod = chronos(amphipodML)
plot(ultramphipod)
amphipodML = drop.tip(amphipodML, which(!(amphipodML$tip.label %in% rownames(reprunedassmatrix))))
ultramphipod = chronos(amphipodML)
plot(ultramphipod)
comm = t(reprunedassmatrix)
cophyloplot(ultramphipod, ultram, assoc = reprunedass)
cophyloplot(ultramphipod, ultram, assoc = reprunedass, length.line = 4, space = 30, gap = 3,col="red", show.tip.label=FALSE)
View(reprunedass)
cophyloplot(ultramphipod, ultram, assoc = reprunedass, length.line = 4, space = 30, gap = 3,col="red")
association<-matrix(ncol=2, nrow=40)
association[,1]<-association[,2]<-tree2$tip.label
View(association)
cophy = cophylo(ultramphipod, ultram, assoc = reprunedass)
cophy = cophylo(ultramphipod, ultram, assoc = reprunedass, rotate = F)
plot(cophy)
cophy = cophylo(ultramphipod, ultram, assoc = reprunedassmatrix, rotate = F)
cophyloplot(ultramphipod, ultram, assoc = reprunedassmatrix)
cophy = cophylo(ultramphipod, ultram, assoc = reprunedassmatrix, rotate = F)
plot(cophy)
cophy = cophylo(ultramphipod, ultram, assoc = reprunedass, rotate = F)
cophyloplot(ultramphipod, ultram, assoc = reprunedass)
View(reprunedass)
superass = cbind(reprunedass,reprunedass)
View(superass)
superass = cat(reprunedass,reprunedass)
superass = abind(reprunedass,reprunedass)
superass = abind(reprunedass[,1]*2,reprunedass[,2]*2)
superass = cbind(reprunedass[,1]*2,reprunedass[,2]*2)
superass = cbind(rep(reprunedass[,1],2),rep(reprunedass[,2],2))
View(superass)
cophyloplot(ultramphipod, ultram, assoc = superass)
cophy = cophylo(ultramphipod, ultram, assoc = reprunedass, rotate = F)
cophy = cophylo(ultram, ultramphipod, assoc = reprunedass, rotate = F)
cophyloplot(ultram, ultramphipod, assoc = reprunedass)
cophyloplot(ultram, ultramphipod, assoc = t(reprunedass))
cophyloplot(ultram, ultramphipod, assoc = cbind(reprunedass[,2],reprunedass[,1]))
ultramphipod, ultram,
cophyloplot(ultramphipod, ultram, assoc = reprunedass)
association <- cbind(ultramphipod$tip.label, ultram$tip.label)
View(association)
cophyloplot(ultramphipod, ultram, assoc = association)
cophyloplot(ultramphipod, ultram, assoc = reprunedass, use.edge.length = T)
cophyloplot(ultramphipod, ultram, assoc = reprunedass)
cophyloplot(ultramphipod, ultram, assoc = reprunedass[1,])
reprunedass = as.data.frame(reprunedass)
cophyloplot(ultramphipod, ultram, assoc = reprunedass[1,])
cophyloplot(ultramphipod, ultram, assoc = reprunedass)
cophyloplot(ultramphipod, ultram, assoc = reprunedass, rotate = T)
plot(amphipodML)
cophyloplot(ultramphipod, ultram, assoc = reprunedass, type = "cladogram")
cophyloplot(ultramphipod, ultram, assoc = reprunedass)
plot(cophy)
cophy = cophylo(ultram, ultramphipod, assoc = reprunedass, rotate = T)
cophy = cophylo(ultram, ultramphipod, assoc = reprunedass, rotate = F)
plot(cophy)
reprunedass
rownames(reprunedass) = 1:nrow(reprunedass)
cophy = cophylo(ultram, ultramphipod, assoc = reprunedass, rotate = F)
plot(cophy)
ultram$tip.label
reprunedass = replace(reprunedass, ' ', '_')
cophy = cophylo(ultram, ultramphipod, assoc = reprunedass, rotate = F)
plot(cophy)
reprunedass = as.matrix(prunedass[which(prunedass[,2] %in% ultram$tip.label),])
reprunedass = reprunedass[match(ultram$tip.label, reprunedass[,2]),]
reprunedass[,1] = replace(reprunedass[,1], ' ', '_')
cophy[1]
cophy[12
]
cophy[2]
cophy = cophylo(ultram, ultramphipod, assoc = reprunedass, rotate = F)
cophy[2]
cophy[3]
cophy[4]
cophy[1]
cophy$trees[1]
cophy$trees[2]
cophy$trees
plot(cophy$trees[2])
xyz = cophy$trees[2]
xyz$tip.labels
cophy$trees[2]$tip.label
reprunedass = str_replace_all(reprunedass,' ', '_')
reprunedass = gsub(reprunedass,' ', '_')
reprunedass = gsub(' ', '_',reprunedass)
reprunedass[,1] = gsub(' ', '_',reprunedass[,1])
reprunedass[1,1] = gsub(' ', '_',reprunedass[1,1])
reprunedass <- as.data.frame(sapply(reprunedass,gsub,pattern=" ",replacement="_"))
reprunedass = as.matrix(prunedass[which(prunedass[,2] %in% ultram$tip.label),])
reprunedass = reprunedass[match(ultram$tip.label, reprunedass[,2]),]
reprunedassmatrix = as.matrix(dcast(as.data.frame(reprunedass), amphipod~host, length))
reprunedassmatrix = reprunedassmatrix[,2:16]
reprunedass <- lapply(reprunedass, function(x) {gsub(" ", "_", x)})
reprunedass = as.matrix(prunedass[which(prunedass[,2] %in% ultram$tip.label),])
reprunedass = reprunedass[match(ultram$tip.label, reprunedass[,2]),]
cophy = cophylo(ultram, ultramphipod, assoc = reprunedass, rotate = F)
cophyloplot(ultramphipod, ultram, assoc = reprunedass)
plot(cophy)
pcd(comm, ultramphipod)
